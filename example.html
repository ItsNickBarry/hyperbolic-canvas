<!doctype html>
<html>
  <head>
    <title>Hyperbolic Canvas Example</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/example.css" />
    <link rel="icon" type="image/png" href="images/favicon.png" />
  </head>
  <body>
    <div id="hyperbolic-canvas"></div>

    <script
      type="application/javascript"
      src="dist/hyperbolic_canvas.js"
    ></script>

    <script type="text/javascript">
      var getQueryVariable = function (variable) {
        // https://css-tricks.com/snippets/javascript/get-url-variables/
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          if (pair[0] == variable) {
            return pair[1];
          }
        }
        return false;
      };

      var ready = function (fn) {
        if (document.readyState != 'loading') {
          fn();
        } else {
          document.addEventListener('DOMContentLoaded', fn);
        }
      };

      var createCanvas = function (selector) {
        var el =
          document.querySelector(selector) || document.createElement('div');

        while (el.firstChild) {
          el.removeChild(el.firstChild);
        }

        var backdrop = document.createElement('div');
        backdrop.className = 'backdrop';
        var underlay = document.createElement('div');
        underlay.className = 'underlay';
        underlay.style.display = 'block';
        var canvasEl = document.createElement('canvas');
        canvasEl.className = 'hyperbolic';
        canvasEl.style.position = 'absolute';

        el.appendChild(backdrop);
        backdrop.appendChild(underlay);
        underlay.appendChild(canvasEl);

        var w = el.clientWidth;
        var h = el.clientHeight;
        var d = w > h ? h : w;
        var r = d / 2;
        underlay.style.width = underlay.style.height = d + 'px';
        backdrop.style.width = backdrop.style.height = d + 'px';
        underlay.style['border-radius'] = Math.floor(r) + 'px';
        canvasEl.style['border-radius'] = Math.floor(r) + 'px';
        canvasEl.width = canvasEl.height = d;

        var ctx = canvasEl.getContext('2d');
        var canvas = new HyperbolicCanvas.Canvas(ctx);

        canvas._el = el;
        canvas._backdrop = backdrop;
        canvas._underlay = underlay;
        canvas._canvas = canvasEl;

        return canvas;
      };

      ready(function () {
        var scriptName = getQueryVariable('script');
        var script = document.createElement('script');
        script.onload = function () {
          var canvas = createCanvas('#hyperbolic-canvas');
          HyperbolicCanvas.scripts[scriptName](canvas);
        };
        script.onerror = function () {
          createCanvas('#hyperbolic-canvas');
          alert('No script found with the name "' + scriptName + '".');
        };
        script.src = 'scripts/' + scriptName + '.js';
        document.body.appendChild(script);
      });
    </script>
  </body>
</html>
